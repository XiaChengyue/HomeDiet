# 一、软件计划文档

## 1.系统概述

随着社会经济的发展，人们的物质生活水平有了大幅的提升。越来越多的人不再纠结于自己的生活问题，更加意识到身体健康与饮食质量的重要性。加上在近几年疫情的影响下，人们的健康意识不断提升，消费者对自身健康的关注度达到了空前的高度。

我们调研了一些和饮食相关的APP（薄荷健康、下厨房等），发现这些软件存在以下缺陷：

1、推荐食谱不智能，无法准确推荐当季供应的食材。

2、购买不方便，在采购食材时，很难一次性买到全部的食材，购买食材难度的增加会削弱用户执行食谱的热情。

3、标量的不清晰，一次需要买多少菜、吃多少菜，用克数来描述非常不准确。

因此，一款能够快速上手，操作简单的软件，可以自动产生推荐食谱并允许用户直接网购对应食物，将节省用户大量的学习及规划时间，具有很强的市场价值。本项目拟开发一款食谱推荐与采购一体化小程序，主要功能为根据用户的个性化数据计算出各英语元素每日摄入量，根据摄入量、时令季节等条件自动产生推荐食谱，同时用户可以在生鲜超市中购买食谱对应的食材，以达到自己的训练目的。

## 2.软件开发过程模型

| **软件生命周期** | **是否首先定义好所有的需求** | **是否有多个开发周期** | **是否有中间软件** |
| ---------------- | ---------------------------- | ---------------------- | ------------------ |
| 瀑布型           | 是                           | 是                     | 没有               |

## 3.项目估算

### 3.1 规模估算

#### 3.1.1 后台规模

| 模块名称     | 描述                                                         | 类型     | 代码行数（LOC） |
| ------------ | ------------------------------------------------------------ | -------- | --------------- |
| 用户数据维护 | 用户登陆、上传身体数据、查询身体数据                         | 简单模块 | 300             |
| 饮食评估     | 根据用户数据进行饮食评估，查询饮食评估结果                   | 简单模块 | 400             |
| 食物排行榜   | 查询食物的营养成分、热量、做法等，并进行排行                 | 简单模块 | 400             |
| 食谱推荐     | 根据饮食评估结果、超市货物量、食物表进行形成推荐食谱，查询、修改食谱 | 中等模块 | 500             |
| 采购食材     | 浏览商品、操作购物车、添加订单、取消订单                     | 复杂模块 | 700             |

#### 3.1.2 页面规模

| 模块名称       | 主要内容                                   | 代码行数（LOC） |
| -------------- | ------------------------------------------ | --------------- |
| 首页           | 显示今日食谱、今日营养比例、食物排行榜入口 | 200             |
| 食谱页         | 显示今日食谱食材和营养分析                 | 300             |
| 食物详情页     | 显示食物的营养元素、热量、做法等           | 100             |
| 食物排行榜页   | 根据蛋白质、脂肪等含量高低显示食物         | 100             |
| 今日营养比例页 | 显示用户今日的营养元素摄入克数、热量等     | 100             |
| 生鲜超市页     | 显示所有商品                               | 300             |
| 商品详情页     | 显示商品详情                               | 100             |
| 购物车页面     | 显示购物车商品                             | 200             |
| 用户中心页     | 显示个人信息和订单管理入口                 | 100             |
| 订单页         | 显示未付款、待提货、已提货订单             | 200             |

### 3.2 进度估算

| **阶段**       | **开始日期** | **结束日期** | **工作日** |
| -------------- | ------------ | ------------ | ---------- |
| 软件计划       | 3.15         | 3.16         | 2          |
| 需求调研       | 3.17         | 3.20         | 4          |
| 需求分析       | 3.21         | 3.27         | 7          |
| 概要设计       | 3.28         | 3.30         | 3          |
| 详细设计       | 3.31         | 4.3          | 4          |
| 编码（第一轮） | 4.4          | 4.17         | 14         |
| 测试（第一轮） | 4.18         | 4.20         | 3          |
| 编码（第二轮） | 4.21         | 5.4          | 14         |
| 测试（第二轮） | 5.5          | 5.7          | 3          |
| 编码（第三轮） | 5.8          | 5.14         | 7          |
| 测试（第三轮） | 5.15         | 5.17         | 3          |
| 部署及验收     | 5.18         | 5.25         | 8          |
| **总计**       | 3.15         | 5.25         | 72         |

### 3.3 工作量估算

| **阶段**   | **阶段工作量占总工作量百分比** | **工作量（人.天）** |
| ---------- | ------------------------------ | ------------------- |
| 软件计划   | 1%                             | 2                   |
| 需求调研   | 5%                             | 8                   |
| 需求分析   | 9%                             | 14                  |
| 概要设计   | 4%                             | 6                   |
| 详细设计   | 8%                             | 12                  |
| 编码       | 58%                            | 84                  |
| 测试       | 6%                             | 9                   |
| 部署及验收 | 5%                             | 8                   |
| **总计**   | 100%                           | 143                 |

### 3.4 成本估算

这里使用阶段成本估算法，阶段平均成本来源于第四章PPT。

|                         | 需求分析 | 设计 | 编码  | 测试 | 总计（人.日） |
| ----------------------- | -------- | ---- | ----- | ---- | ------------- |
| 工作量                  | 24       | 18   | 84    | 17   | 143           |
| 阶段平均成本（元/人日） | 173      | 160  | 141   | 150  |               |
| 成本（元）              | 4152     | 2800 | 11844 | 2550 | 21346         |

## 4 人力资源安排

| **阶段**   | 分工                   |
| ---------- | ---------------------- |
| 软件计划   | 阁承越                 |
| 需求调研   | 阁承越、刘涛榕、陈政宇 |
| 需求分析   | 阁承越、刘涛榕         |
| 概要设计   | 刘涛榕                 |
| 详细设计   | 刘涛榕                 |
| 编码       | 阁承越、陈政宇、赖金熠 |
| 测试       | 李浩哲                 |
| 部署及验收 | 陈政宇                 |

## 5 开发环境

### 5.1 硬件环境

| 设备名称    | 用途     | 配置信息                                  |
| ----------- | -------- | ----------------------------------------- |
| 笔记本电脑  | 数据爬虫 | Intel Core i7-9750H @ 2.60GHz 六核，16 GB |
| MacBook Air | 后端开发 | Apple M1，8GB                             |
| 台式机      | 前端开发 | CPU: AMD R5-3600X GPU: Nvdia 3060         |

### 5.2 软件环境

| 软件名称        | 软件类别     | 版本号   | 补丁程序                                    | 应用     |
| --------------- | ------------ | -------- | ------------------------------------------- | -------- |
| IntelliJ IDEA   | Java集成环境 | 2021.2.2 | Maven、Springboot、Mybatis-plus、swagger-ui | 后端开发 |
| Mysql Workbench | 数据库       | 8.0.28   | 无                                          | 数据库   |
| HBuilder X      | 前端编辑器   | V3.3.13  | Uni-app                                     | 前端开发 |
| 微信开发者工具  | 前端开发工具 | 1.2.0.0  | 无                                          | 前端开发 |
| Postman         | 接口测试工具 | v9.15.10 | 无                                          | 接口测试 |

## 6 测试环境

### 6.1 硬件设备

| 设备名称        | 用途                               | 配置信息                                                     | 备注                     |
| --------------- | ---------------------------------- | ------------------------------------------------------------ | ------------------------ |
| DESKTOP-CEERHJE | 用于功能测试用例、健壮性及压力测试 | 处理器:lntel(R) Core(TM)i7-8750H RAM: 16.0 GB 系统类型：Windows10 64位操作系统 | 用于测试的个人笔记本电脑 |

### 6.2 软件环境

| 软件名称          | 软件类别     | 版本号   | 补丁程序 | 备注         |
| ----------------- | ------------ | -------- | -------- | ------------ |
| 微信web开发者工具 | 应用程序     | 1.2.0.0  | 无       | 用于界面测试 |
| Postman           | 接口测试工具 | v9.15.10 | 无       | 用于接口测试 |

## 7 风险估计和控制

| 风险描述                                                     | 降低风险策略                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 需求风险：需求定义欠佳:不清晰、不准确、不一致。增加了额外的需求。 | 经线上讨论后，全组人员明确了需求。                           |
| 产品风险：诸如每日自动菜品推荐模块，错误发生率高，容易给出非人性化推荐，需要更多的时间对它进行测试和重构。 | 将改功能的开发延后，待其他项目开发完毕后开发。               |
| 人员风险：由于沟通不畅，容易出现接口错误和额外重复的工作。   | 进行分工，并利用合作开发工具进行开发，避免进行额外重复的工作。 |

## 8 测试计划

| 测试 | 测试类型 | 负责人及成员 | 时间                |
| ---- | -------- | ------------ | ------------------- |
| 1    | 单元     | 李浩哲       | 2022/4/10-2022/4/13 |
| 2    | 集成     | 李浩哲       | 2022/4/14-2022/4/16 |
| 3    | 系统     | 李浩哲       | 2022/4/16-2022/4/17 |
| 4    | 验收     | 全组成员     | 2022/4/18-2022/4/19 |

### 9 评审计划

| **评审活动名称** | **评审对象**               | **评审人员** | **评审活动时间** |
| ---------------- | -------------------------- | ------------ | ---------------- |
| 审查             | 软件计划                   | 全体人员     | 3.20             |
| 审查             | 需求文档                   | 全体人员     | 3.27             |
| 审查             | 概要设计文档               | 全体人员     | 4.3              |
| 审查             | UI设计                     | 刘涛榕       | 4.10             |
| 审查             | 前端实现                   | 赖金熠       | 4.20             |
| 审查             | 前端、接口实现             | 阁承越       | 5.1              |
| 审查             | 前端、后端、前后端交互实现 | 陈政宇       | 5.8              |
| 审查             | 整体实现                   | 李浩哲       | 5.15             |

### 10 质量保证计划

项目QA人员组成：阁承越 刘涛榕 陈政宇 赖金熠 李浩哲

QA活动安排

| QA任务                   | 计划日期 | 活动形式 | QA人员                 | 项目组参与成员 |
| ------------------------ | -------- | -------- | ---------------------- | -------------- |
| 软件计划评审             | 3.20     | 评审会   | 阁承越                 | 全体人员       |
| 需求文档评审             | 3.27     | 评审会   | 阁承越                 | 全体人员       |
| 概要设计评审             | 4.3      | 评审会   | 阁承越                 | 全体人员       |
| UI设计评审               | 4.10     | 评审会   | 刘涛榕                 | 全体人员       |
| 前端设计评审             | 4.20     | 评审会   | 赖金熠                 | 全体人员       |
| 前端实现及接口设计评审   | 5.1      | 评审会   | 赖金熠、阁承越         | 全体人员       |
| 后端实现及前后端交互评审 | 5.8      | 评审会   | 赖金熠、阁承越、陈政宇 | 全体人员       |
| 全面评审                 | 5.15     | 评审会   | 阁承越、李浩哲         | 全体人员       |

# 二、需求分析

## 1 系统概述

本项目拟开发一款饮食推荐和生鲜超市结合的健康小程序，用途是提高用户健康生活管理的效率。其主要功能为，根据用户的个性化数据计算出各元素每日摄入量，根据摄入量、时令季节元素比例等自动产生推荐食谱，同时允许用户于生鲜超市系统中购买食谱对应的食材，以达到自己的训练目的。

其特性在于：                  

相比于目前市面上的健康app，小程序并不需要下载，使用起来也更加方便快捷；

本项目以量身定制推荐食谱为主要功能，填补了市场空白；

本项目结合了电商超市系统，创新性地实现了食谱推荐到食材采购地一条龙服务。

## 2 需求概述

### 2.1 目标

在大中城市生活的人们，生活节奏较快，加班时间较长，没有做饭经验，他们在外就餐、订外卖、购买速冻食品的频率很高，这将带来潜在的健康问题。同时，人们的健康营养知识薄弱，需要专业且科学的指导。

目前市面上的app大多是以健身教学、运动计时、久坐提醒等功能为主，少有以量身定制推荐食谱为主要功能的产品，因此我们以推荐食谱与线上超市为主要功能，开发制作一款能够快速上手，操作简单的软件，不仅大大降低用户在搜索食谱食材上花费的时间，同时提供专业且科学的指导，为追求健康生活的用户提供便利。

### 2.2 运行环境

| **运行环境**     | **版本信息**                                  |
| ---------------- | --------------------------------------------- |
| 开发硬件环境     | 普通兼容机CPU：i3-7350K，内存：4G，硬盘：380G |
| 运行硬件环境     | CPU：i3及以上；2GB内存；100G硬盘及以上        |
| 数据库环境       | MySQL-community-server 5.7.8                  |
| 开发操作系统     | Windows7及以上操作系统                        |
| 软件运行支撑环境 | Android4.0及以上操作系统                      |

### 2.3 用户特点

本项目瞄准的用户受众：

1. 食品购物电商平台：提供线上超市服务，本项目将为其带来更大的流量和更高的利润；

2. 营养师：需要本项目的食材营养价值查询服务；

3. 有健康饮食需求的上班族：需要本项目的食谱推荐与线上超市服务；

4. 有减肥或增肌需求的青年群体：需要本项目的每日摄入量查询服务；

### 2.4 关键点

关键功能：

1. 用户饮食评估

用户可以输入身体数据，小程序会根据身⾼体重、运动量来估算每⽇摄⼊量和蛋⽩质脂肪碳⽔元素的⽐例。

2. 食谱推荐算法

根据摄⼊量、元素⽐例、当季时节、用户忌口等属性，推荐适合用户、符合用户需求的食谱搭配。除了早午晚三餐的食谱推荐，后续还可以各个主题的食谱推荐，例如“减脂食谱”，“增肌食谱”，“食疗食谱”等。

3. ⽣鲜超市模块

与生鲜超市合作，内含品质有保障的健康食品，生成当日食谱的购物清单，一键购买，一键到家。

4. 食谱分享

增加软件的社交属性，用户可以分享食谱，浏览别人的食谱，系统可以标注出合适用户的食谱，供用户进行调整。

关键技术：

1.爬虫：python爬虫模块获取网络上的食材营养价值数据；

2.前端：uni-app、微信小程序开发

3.后端：Springboot、Mybatis-plus

关键算法：

1、饮食评估：根据用户输入的身体数据分析出用户一天的总摄入量、蛋白质、脂肪、碳水化合物的摄入量

2、食谱推荐：根据用户喜好、当季当地食材来进行推荐

## 3 运行环境

软件环境：

|            | **名称**               | **版本**  |
| ---------- | ---------------------- | --------- |
| 操作系统   | Windows 11 家庭中文版  | 22000.556 |
| 数据库平台 | MySQL-community-server | 5.7.8     |
| 应用平台   | 微信小程序             | 不限      |
| 前端开发   | HBuilder X             | V3.3.13   |
| 后端开发   | IntelliJ IDEA          | 2021.2.2  |

硬件环境：

| **服务器**   | 名称           | **配置**                                |
| ------------ | -------------- | --------------------------------------- |
| 应用服务器   | 轻量应用服务器 | 2核CPU、2GB内存 (通用型-2核2G-40G-300G) |
| 数据库服务器 | 轻量应用服务器 | 2核CPU、2GB内存 (通用型-2核2G-40G-300G) |

## 4 需求规定

### 4.1 软件系统总体功能结构

就我们的健康饮食推荐系统而言，该系统具有以下四个功能模块：用户管理模块，个人健康信息数据管理模块，食谱推荐以及购物商城模块。四个模块的细化功能如下图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/system1.png?raw=true)

### 4.2 功能需求

总用例图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/usecase1.png?raw=true)

用例描述：

| 用例名称：用户登陆                                           |
| ------------------------------------------------------------ |
| 用例标识号：001                                              |
| 参与者：用户                                                 |
| 简要说明： 新用户利用微信账号进行登录。                      |
| 前置条件： 用户已经拥有微信账号                              |
| 基本事件流： 1．用户点击“登录”按钮 2．系统显示登录页面 3.用户对小程序进行账号登录授权 4．按“登录”按钮，登录成功   5．用例终止 |
| 其他事件流A1： 用户点击取消，登录终止                        |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试登录 |
| 后置条件： 用户可以提交和修改个人健康信息数据，查看当日食谱和分享，查询食物的热量，在商城中添加商品到购物车 |
| 注释：无                                                     |

| 用例名称：录入身体数据                                       |
| ------------------------------------------------------------ |
| 用例标识号：002                                              |
| 参与者：用户                                                 |
| 简要说明： 新用户首次使用小程序时需提交个人身体信息进行评估  |
| 前置条件： 用户已经登录小程序                                |
| 基本事件流： 1．用户点击“开启减脂之旅”按钮 2．系统显示提交个人信息页面 3.用户对个人信息进行填写 4．按“确定”按钮，后台开始进行计算和评估   5．用例终止 |
| 其他事件流A1： 用户点击返回，信息提交终止                    |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试登录 |
| 后置条件： 用户可以修改个人健康信息数据                      |
| 注释：无                                                     |

| 用例名称：更新身体数据                                       |
| ------------------------------------------------------------ |
| 用例标识号：003                                              |
| 参与者：用户                                                 |
| 简要说明： 用户进行了一段时间的减脂之后，需要对个人的身体信息做出调整。 |
| 前置条件： 数据库中有用户的身体信息                          |
| 基本事件流： 1．用户在我的页面 点击个人信息菜单栏 2．系统显示个人信息页面 3.在信息栏进行修改4.点击确定按钮，后台开始对新的信息做出评估 5.用例终止 |
| 其他事件流A1： 用户点击取消，修改终止                        |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试   |
| 后置条件： 用户可以修改个人健康信息数据，查看新推荐的当日食谱和分享 |
| 注释：无                                                     |

| 用例名称：分享食谱                                           |
| ------------------------------------------------------------ |
| 用例标识号：004                                              |
| 参与者：用户                                                 |
| 简要说明： 用户看到系统后台推荐的食谱，觉得很不错，对食谱进行分享和推广 |
| 前置条件： 后台拥有用户的信息并开始生成推荐食谱，用户登录小程序，查看食谱 |
| 基本事件流： 1．用户点击“分享”按钮 2．系统显示分享页面 3.按“确定”按钮，分享成功   5．用例终止 |
| 其他事件流A1： 用户点击取消，分享终止                        |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试   |
| 后置条件： 无                                                |
| 注释：无                                                     |

| 用例名称：添加购物车                                         |
| ------------------------------------------------------------ |
| 用例标识号：005                                              |
| 参与者：用户                                                 |
| 简要说明： 用户在商城中逛到需要购买的食物，想添加进购物车    |
| 前置条件： 用户登录小程序                                    |
| 基本事件流： 1．用户点击食品详情页面 2．点击加入购物车 3.对食品数量进行修改  4.用例终止 |
| 其他事件流A1： 用户点击返回，用例终止                        |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试   |
| 后置条件： 无                                                |
| 注释：无                                                     |

| 用例名称：查询食物热量                                       |
| ------------------------------------------------------------ |
| 用例标识号：006                                              |
| 参与者：用户                                                 |
| 简要说明： 用户想要精细化个人当天饮食，了解具体食物的热量    |
| 前置条件： 用户登录小程序，                                  |
| 基本事件流： 1．用户进入搜索页面 2．用户输入关键词 3.数据库进行模糊匹配与搜索  4.用户点击目标食品进行查看  5.用例终止 |
| 其他事件流A1： 用户退出搜索，用例终止                        |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试   |
| 后置条件： 无                                                |
| 注释：无                                                     |

| 用例名称：查看食谱                                           |
| ------------------------------------------------------------ |
| 用例标识号：007                                              |
| 参与者：用户                                                 |
| 简要说明： 用户开始新的一天，对每日饮食进行规划              |
| 前置条件： 用户登录小程序，后台拥有用户的个人信息并开始生成推荐食谱 |
| 基本事件流： 1．用户点击“今日饮食，动态规划”按钮 2．系统显示今日食谱页面 3.点击目标食谱查看详情   4．用例终止 |
| 其他事件流A1： 用户退出登录，用例终止                        |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试   |
| 后置条件： 无                                                |
| 注释：无                                                     |

| 用例名称：修改食谱                                           |
| ------------------------------------------------------------ |
| 用例标识号：008                                              |
| 参与者：用户                                                 |
| 简要说明： 用户想对当日食谱进行修改                          |
| 前置条件： 用户登录小程序，后台拥有用户的个人信息并已生成推荐食谱 |
| 基本事件流： 1．用户点击添加按钮添加食物或滑动删除食物 2．点击确定后系统重新生成当日食谱分析  3．用例终止 |
| 其他事件流A1： 用户取消修改，用例终止                        |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试   |
| 后置条件： 系统重新评估当日食谱                              |
| 注释：无                                                     |

| 用例名称：添加订单                                           |
| ------------------------------------------------------------ |
| 用例标识号：009                                              |
| 参与者：用户                                                 |
| 简要说明： 用户想购买购物车内的商品                          |
| 前置条件： 用户登录小程序                                    |
| 基本事件流： 1．用户点击购物车详情页面 2．点击下单 3.订单创建  4．支付金额 5.用例终止 |
| 其他事件流A1： 用户被其他app消息弹出，购物过程被终止         |
| 异常事件流： 1．网络异常，无法连接到服务器，请刷新重新尝试   |
| 后置条件： 调用微信支付接口                                  |
| 注释：无                                                     |

顺序图

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/1.png?raw=true)

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/time2.png?raw=true)

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/time4.png?raw=true)

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/time5.png?raw=true)

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/time6.png?raw=true)

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/time7.png?raw=true)

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/time7.png?raw=true)

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/9.png?raw=true)

UML图

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/umlDiet.png?raw=true)

数据流图：

顶层

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/d.png?raw=true)

0层

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/d0.png?raw=true)

1层

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/d1.png?raw=true)

### 4.3 非功能性需求

1. 性能需求

对于用户的正常操作而言，保证小程序运行流畅不掉帧不卡顿，可以实时执行事件。

2. 并发性需求

允许多个用户同时在线登录

3. 安全性需求

保证用户个人隐私数据如身高体重等不被泄露；

收集用户个人信息仅用作食谱推荐算法计算。

## 三、概要设计

### 1 系统概述

本项目拟开发一款食谱推荐与采购一体化小程序，主要功能为根据用户的个性化数据计算出各英语元素每日摄入量，根据摄入量、时令季节等条件自动产生推荐食谱，同时用户可以在生鲜超市中购买食谱对应的食材，以达到自己的训练目的。

### 2 运行环境

#### 2.1 软件环境

| **软件名称**   | **软件类别**   | **版本号** | **补丁程序** | **备注** |
| -------------- | -------------- | ---------- | ------------ | -------- |
| 微信开发者工具 | 编译、调试工具 | 1.05       |              |          |

#### 2.2 硬件环境

| **设备名称** | **用途** | **配置信息**                                          | **备注**                                        |
| ------------ | -------- | ----------------------------------------------------- | ----------------------------------------------- |
| 台式机       | 设计前端 | CPU: AMD R5-3600XGPU: Nvdia 3060内存: 16GB            | 操作系统：windows 10 64 位                      |
| 笔记本4      | 测试     | CPU: Intel i7-8750H内存：16GB                         | 操作系统：windows 10 64位                       |
| 手机         | 测试     | CPU：Helio G90T运行内存：6GB                          | 手机型号：Redmi Note 8 Pro操作系统：MIUI 12.0.3 |
| 笔记本2      | 后端     | CPU: Intel Core i7-9750HGPU: Nvidia 1660 Ti内存: 16GB | 操作系统：windows 10 64 位                      |

#### 2.3 开发环境

| **软件名称**     | **软件类别**   | **版本号** | **补丁程序** | **备注**     |
| ---------------- | -------------- | ---------- | ------------ | ------------ |
| 微信开发者工具   | 编译、调试工具 | 1.05       |              |              |
| HBuilder X       | 编辑器         | 3.3.13     |              | uni-app      |
| PhpStudy         | 服务器集成环境 | 8.1.1.3    |              | apache,mysql |
| Node.js          | 运行环境       | 16.14.2    |              | javascript   |
| npm              | 打包管理工具   | 8.5.0      |              | javascript   |
| Mockitt墨刀      | UI设计软件     | 1.2.5      |              |              |
| Jupyter Notebook | 编辑器         | 6.3.0      |              | python       |
| IntelliJ IDEA    | 后端开发编译器 | 2021.2.2   |              | Java         |

### 3 软件架构及说明（软件架构图）

本项目采用的是MVC模式，分为DAO层连接数据库进行CRUD操作，Service层处理各类业务逻辑，Controller层为页面的控制器，提供接口供外部调用。

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/architecture.png?raw=true)

### 4 网络拓扑图

通过客户端向服务器发送Http请求，再由服务器使用JDBC访问数据库服务器，得到数据后再返回给客户端。

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/network.png?raw=true)

### 5 关键技术与算法

#### 5.1 关键技术

后端：

(1) 网络爬虫

Python urllib、Requests、BeautifulSoup等库实现互联网食物成分表html页面信息爬取。

(2) Springboot框架

(3) MyBatis-plus

(4) 数据库

MySQL-community-server 5.7.8

(5) 服务器

腾讯轻量应用服务器(通用型-2核2G-40G-300G)

 前端：

(1) VUE框架

(2) NodeJS

#### 5.2 关键算法

**1. 饮食评估算法**

(1) 算法功能

用户输入身体数据，如果数据格式合法，算法根据身高、体重、运动量来估算每日摄⼊量和蛋白质脂肪碳⽔元素的⽐例。

(2) 输入输出

① 输入数据

·身高（cm）: height

·体重（kg）: weight

·年龄（岁）: age

·运动频率：

五选一：

几乎不运动；每周轻运动1-3次；每周中等强度运动3-5次；每周运动6-7次；每天高强度运动

·训练目标：增肌；减脂

② 输出数据

每日：

·卡路里（kcal）

·脂肪摄入量（g）

·蛋白质摄入量（g）

·碳水化合物摄入量（g）

·纤维素摄入量（g）

(3) 算法步骤

① 计算基础代谢率（BMR）

·男性BMR = 67 + 13.73 * weight + 5 * height - 6.9 * age

·女性BMR = 66.1 + 9.6 * weight + 1.72 * height - 4.7 * age

② 计算日常消耗代谢总量（TDEE）

·根据运动频率得到量化值t如下：

1.2 =几乎不运动，常坐办公室

1.375 = 每天也就站站走走路，比如教师，或者每周轻运动１－３次

1.55 = 还算比较活跃，每天在外面跑，或者中等强度运动每周３－５天

​    1.725 = 很活跃，体力劳动者，或者每周运动６－７次

1.9 = 运动员，教练等每天大强度体力劳动者

·根据公式计算TDEE如下：

TDEE = BMR * t

③ 计算日常摄入卡路里（DCI）

​	·根据训练目标分别计算日常摄入卡路里DCI：

增肌DCI = TDEE * (100%+15%) 

减脂DCI = TDEE * (100%-10%)

④ 计算营养素日常摄入量

·脂肪日常摄入量 = DCI * 20% / 9 

·蛋白质日常摄入量 = height * 1.5

·碳水化合物日常摄入量 

=（总卡路里 - 脂肪热量 - 蛋白质热量）/ 4

= (DCI - DCI * 20% - height * 1.5 * 4) / 4

·纤维素日常摄入量

如果DCI <= 1800，取值25；

如果1800 < DCI < 2800，取值30；

如果DCI >= 2800，取值35；

⑤ 计算早中晚三餐营养素日常摄入量

早、中、晚三餐的摄入量分配比例为：30%，40%，30%。

**2. 食谱推荐算法**

(1) 算法功能

根据摄⼊量、元素⽐例、当季时节、用户忌口等属性，推荐适合用户、符合用户需求的食谱搭配。除了早午晚三餐的食谱推荐，后续还可以各个主题的食谱推荐，例如“减脂食谱”，“增肌食谱”，“食疗食谱”等。

(2) 输入输出

① 输入数据

·早中晚三餐营养素日常摄入量（g）

·用户饮食习惯

·用户忌口

·食谱种类

② 输出数据

早、中、晚三餐食谱。

(3) 算法步骤

① 主食推荐

·备选标签：数据库的“谷薯芋、杂豆、主食”种类。

·主食品种选择：根据用户饮食习惯来确定，优先选择用户喜爱的主食，北方以面食为主，南方以米饭为主。另外，再选择一种主食，保证食物种类多样化。

·主食摄入量计算：用户喜爱的主食A和系统额外推荐的主食B分别提供80%和20%的碳水化合物。根据数据库中的食物成分表，和饮食评估算法得到的早中晚三餐营养素日常摄入量，计算得A，B主食分别的所需摄入量。

② 副食推荐

·蛋白质的食物来源

计算步骤如下：

计算主食中含有的蛋白质重量；

用蛋白质摄入量减去主食中蛋白质重量，即为副食提供的蛋白质重量；

设定副食中蛋白质的2/3由数据库中标签为“蛋类、肉类及制品”的食物供给，1/3由标签为“坚果、大豆及制品”供给，求出各自的蛋白质供给量；

推荐各类肉蛋类及豆制品。

·脂肪的食物来源

主要来源于植物油和动物脂肪。

计算步骤如下：

计算副食中含有的脂肪重量；

用脂肪摄入量减去副食中脂肪重量，即为植物油提供的脂肪重量；

·纤维素的食物来源

根据时令和每餐纤维素摄入量，设计推荐蔬菜的品种和相应重量。

③ 食谱调整

计算推荐食谱各种营养素的含量，与饮食评估算法得到的每日三餐营养素摄入量相比较，相差不大可以认为合乎要求，否则要增减或者更换主、副食的品种或数量。

### 6 系统功能设计

#### 6.1 个人健康信息模块

个人健康信息模块主要包括首次登陆时上传身体数据，录入数据后，后台自动分析生成用户的饮食评估结果；用户更新身体数据，后台自动分析生成用户新的饮食评估结果。

该模块主要涉及DAO层的User实体类的相关数据，这里创建UserMapper用于连接数据库进行数据的CRUD操作，继承Mybatis-plus的BaseMapper接口。接着创建IUserService接口(同样继承Mybatis-plus的IService接口)，实现关于User类的业务逻辑，这里的业务逻辑主要是分析生成饮食评估结果。最后创建UserController生成个人健康信息模块的功能接口。具体类图如下：

![截屏2022-05-07 下午4.45.32](https://github.com/XiaChengyue/HomeDiet/blob/main/images/useruml.png?raw=true)

上传身体数据和更新身体数据的过程大体一致，这里将重点描述上传身体数据的功能。

##### 6.1.1 上传、分析身体数据

功能描述：用户上传自己的身体数据，后端接收到后生成用户的饮食评估结果，存入数据库中。

接口描述：

请求方式：POST

请求参数：

| 参数名    | 类型   | 是否必须 | 说明       |
| --------- | ------ | -------- | ---------- |
| username  | String | 是       | 用户名     |
| openid    | String | 是       | 微信openid |
| weight    | String | 是       | 体重       |
| height    | String | 是       | 身高       |
| age       | String | 是       | 年龄       |
| frequency | String | 是       | 锻炼频率   |
| goal      | String | 是       | 锻炼目标   |
| gender    | String | 是       | 性别       |

返回数据：JSON

| 参数名  | 类型   | 是否必须 | 说明                           |
| ------- | ------ | -------- | ------------------------------ |
| code    | Number | 是       | 成功：0  失败：211             |
| message | String | 是       | 成功：“成功”  失败：“系统错误" |

顺序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/userTime1.png?raw=true)

##### 6.1.2 查询用户

功能描述：输入用户的openid，返回用户信息，传入空值返回所有用户信息

接口描述：

请求方式：GET

请求参数：

| 参数名 | 类型   | 是否必须 | 说明       |
| ------ | ------ | -------- | ---------- |
| openid | String | 否       | 微信openid |

返回数据：JSON

| 参数名  | 类型   | 是否必须 | 说明                        |
| ------- | ------ | -------- | --------------------------- |
| code    | Number | 是       | 成功：0  失败：211          |
| message | String | 是       | 成功：成功 失败：“系统错误" |
| data    | String | 是       | 包含User的数组              |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/userTime2.png?raw=true)

#### 6.2 食谱推荐模块

食谱推荐模块包括生成食谱、查询食谱、修改食谱、分享食谱，其中生成食谱为后台每日自动更新后自行插入数据库。分享食谱和修改食谱的功能描述和时序图类似，只是分享食谱的请求方式是POST，修改食谱的请求方式是PUT，下面主要介绍分享食谱。

该模块主要涉及DAO层的Diet实体类的相关数据，这里创建DietMapper用于连接数据库进行数据的CRUD操作，继承Mybatis-plus的BaseMapper接口。接着创建IDietService接口(同样继承Mybatis-plus的IService接口)，实现关于Diet类的业务逻辑，这里的业务逻辑主要是自动生成每日食谱。最后创建DietController生成食谱推荐模块的功能接口。具体类图如下：

![](https://raw.githubusercontent.com/XiaChengyue/HomeDiet/main/images/dietUml.png)

##### 6.2.1 推荐食谱

功能描述：在业务逻辑层的updateDiet函数中，读取所有用户数据和食物库所有食物信息，根据用户数据生成一日食谱，存入数据库。

该功能为后端自动调用，故不需要设置接口。

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/dietTime1.png?raw=true)

##### 6.2.2 查询食谱

功能描述：用户查询今日食谱，后台返回今日食谱，并调用食谱分析业务逻辑，返回该食谱的分析结果。

接口描述：

请求方式：GET

请求参数：

| 参数名 | 类型   | 是否必须 | 说明       |
| ------ | ------ | -------- | ---------- |
| openid | String | 是       | 微信openid |

返回参数：JSON

| 参数名  | 类型   | 是否必须 | 说明                                                         |
| ------- | ------ | -------- | ------------------------------------------------------------ |
| code    | Number | 是       | 成功：0  失败：211                                           |
| message | String | 是       | 成功：成功 失败：“系统错误"                                  |
| data    | String | 是       | 包含Diet的数组，和脂肪含量fat、碳水含量cho、蛋白质含量pro、热量cal |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/dietTIme2.png?raw=true)

##### 6.2.3 分享食谱

功能描述：用户自动创建食谱，发送给后台，完成分享。

接口描述：

请求方式：POST

请求参数：

其中除了openid，食谱的上传形式为diet数组，例如[{foodid:"1";time:"午餐";weight:"200克"},{foodid:"2";time:"午餐";weight:"300克"}]

| 参数名 | 类型   | 是否必须 | 说明       |
| ------ | ------ | -------- | ---------- |
| openid | String | 是       | 微信openid |
| foodid | String | 是       | 食物的id   |
| time   | String | 是       | 进食时间   |
| weight | String | 是       | 食物重量   |

返回参数：JSON

| 参数名  | 类型   | 是否必须 | 说明                           |
| ------- | ------ | -------- | ------------------------------ |
| code    | Number | 是       | 成功：0  失败：211             |
| message | String | 是       | 成功：“成功”  失败：“系统错误" |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/dietTime3.png?raw=true)

#### 6.3购物商城模块

购物商城模块包括查看商品、添加购物车和添加订单。

该模块主要涉及DAO层的商品类Item、购物车类Cart、订单类Order的相关数据，这里创建ItemMapper、CartMapper、OrderMapper用于连接数据库进行数据的CRUD操作，继承Mybatis-plus的BaseMapper接口。接着创建IItemService接口、ICartService接口、IOrderService接口(同样继承Mybatis-plus的IService接口)，实现业务逻辑。最后创建ItemController、CartController、OrderController生成购物商城模块的功能接口。具体类图如下：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/itemUml.png?raw=true)



![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/orderUml.png?raw=true)

##### 6.3.1 查看商品

功能描述：输入商品id，查看商品信息，输入为空则返回所有商品信息。

接口描述：

请求方式：GET

请求参数：

| 参数名 | 类型   | 是否必须 | 说明   |
| ------ | ------ | -------- | ------ |
| id     | String | 否       | 商品id |

返回参数：JSON

| 参数名  | 类型   | 是否必须 | 说明                        |
| ------- | ------ | -------- | --------------------------- |
| code    | Number | 是       | 成功：0  失败：211          |
| message | String | 是       | 成功：成功 失败：“系统错误" |
| data    | String | 是       | 包含Item的数组              |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/itemTime1.png?raw=true)

##### 6.3.2 添加购物车

功能描述：用户对感兴趣的商品点击添加购物车，传入数据库。

接口描述：

请求方式：POST

请求参数：

其中除了openid，食谱的上传形式为diet数组，例如[{foodid:"1";time:"午餐";weight:"200克"},{foodid:"2";time:"午餐";weight:"300克"}]

| 参数名  | 类型   | 是否必须 | 说明       |
| ------- | ------ | -------- | ---------- |
| openid  | String | 是       | 微信openid |
| Iitemid | String | 是       | 商品的id   |
| number  | String | 是       | 数量       |

返回参数：JSON

| 参数名  | 类型   | 是否必须 | 说明                           |
| ------- | ------ | -------- | ------------------------------ |
| code    | Number | 是       | 成功：0  失败：211             |
| message | String | 是       | 成功：“成功”  失败：“系统错误" |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/cartTime1.png?raw=true)

##### 6.3.3 查看购物车

功能描述：用户查看购物车内容

接口描述：

请求方式：GET

请求参数：

| 参数名 | 类型   | 是否必须 | 说明       |
| ------ | ------ | -------- | ---------- |
| openid | String | 否       | 微信openid |

返回参数：JSON

| 参数名  | 类型   | 是否必须 | 说明                           |
| ------- | ------ | -------- | ------------------------------ |
| code    | Number | 是       | 成功：0  失败：211             |
| message | String | 是       | 成功：成功 失败：“系统错误"    |
| data    | String | 是       | 返回购物车内商品信息、商品数量 |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/cartTime2.png?raw=true)

##### 6.3.4 添加订单

功能描述：用户点击下单，添加订单到数据库

接口描述：

请求方式：POST

请求参数：

| 参数名  | 类型   | 是否必须 | 说明       |
| ------- | ------ | -------- | ---------- |
| openid  | String | 是       | 微信openid |
| time    | String | 是       | 下单时间   |
| address | String | 是       | 地址       |
| itemid  | String | 是       | 商品id     |
| number  | String | 是       | 商品数量   |
| price   | String | 是       | 价格       |

返回参数：JSON

| 参数名  | 类型   | 是否必须 | 说明                           |
| ------- | ------ | -------- | ------------------------------ |
| code    | Number | 是       | 成功：0  失败：211             |
| message | String | 是       | 成功：“成功”  失败：“系统错误" |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/orderTime1.png?raw=true)

6.3.5 查看订单

功能描述：用户查询自己的订单，orderid为空时返回该用户所有订单

接口描述：

请求方式：GET

请求参数：

| 参数名  | 类型   | 是否必须 | 说明       |
| ------- | ------ | -------- | ---------- |
| openid  | String | 是       | 微信openid |
| orderid | String | 否       | 订单id     |

返回参数：JSON

| 参数名  | 类型   | 是否必须 | 说明                        |
| ------- | ------ | -------- | --------------------------- |
| code    | Number | 是       | 成功：0  失败：211          |
| message | String | 是       | 成功：成功 失败：“系统错误" |
| data    | String | 是       | 返回订单数组                |

时序图：

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/orderTime2.png?raw=true)

### 7 数据库设计

#### 7.1 采用的数据库

Mysql Workbench 8.0.28

#### 7.2 数据库表的设计

表名：diet

表描述：用户食谱信息

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/dietsql.png?raw=true)

表名：food

表描述：食物信息

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/foodsql.png?raw=true)

表名：user 

表描述：用户信息

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/usersql.png?raw=true)

表名：item

表描述：商品信息

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/itemsql.png?raw=true)

表名：order

表描述：订单信息

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/ordersql.png?raw=true)

表名：cart

表描述：购物车信息

![](https://github.com/XiaChengyue/HomeDiet/blob/main/images/cartsql.png?raw=true)



